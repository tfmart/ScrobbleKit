# Authenticating an User

For services requiring authentication, discover how to sign in with a Last.fm account using ScrobbleKit.

## Overview

Certain ScrobbleKit services, such as scrobbling a song to a Last.fm profile, necessitate authentication from a valid Last.fm account. To perform these actions, a valid token generated by Last.fm is required, and ScrobbleKit can assist in generating one.

### Generating a Session Token

Use the ``SBKManager/startSession(username:password:)`` method to create a new token by providing the Last.fm account's username and password.

- Warning:
Last.fm's API does not support authentication via email; you must provide the account's username under the username parameter.

```swift
let manager = SBKManager(apiKey: API_KEY, secret: SECRET_KEY)

do {
    try await manager.startSession(username: USERNAME, secret: PASSWORD)
} catch {
    // Handle sign-in error
}
```

Upon successful authentication, the ``SBKManager`` instance will automatically set the generated token for subsequent requests. However, it is recommended that your application securely stores the generated token, allowing it to access authenticated services without requiring users to repeatedly authenticate with their Last.fm account.

Retrieve the session token from the ``SBKSessionResponseInfo`` instance returned by the ``SBKManager/startSession(username:password:)`` method, using the ``SBKSessionResponseInfo/key`` property:

```swift
do {
    let response = try await manager.startSession(username: USERNAME, secret: PASSWORD)
    let token = response.key
} catch {
    // Handle error
}
```

### Using an Existing Session Token

If you already have a valid session token, provide it to the ``SBKManager/setSessionKey(_:)`` method:

```swift
manager.setSessionKey(SESSION_KEY)
```

This action also saves the session token to the manager instance for future Ã§use
